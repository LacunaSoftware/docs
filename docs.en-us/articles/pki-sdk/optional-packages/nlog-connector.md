# NLog Connector

The package [Lacuna PKI NLog Connector](https://www.nuget.org/packages/Lacuna.Pki.NLogConnector/) enables sending log
messages generated by the PKI SDK to the [NLog](http://nlog-project.org/) logging library.

## Usage

All you need to do is make the following call somewhere in your code, preferably on the startup of your application
or website:

```cs
Lacuna.Pki.NLogConnector.NLogLogger.Configure();
```

From then on, all log messages generated by the SDK will be forwarded to NLog. Configuration of NLog, however, is up
to you. The following would be an example of a `web.config`/`app.config` file to save log messages to a file:

```xml
<?xml version="1.0" encoding="utf-8"?>
<configuration>
	<configSections>
		<section name="nlog" type="NLog.Config.ConfigSectionHandler, NLog" />
	</configSections>
	<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<targets async="true">
			<target name="pkiLog" xsi:type="File" fileName="C:\Logs\LacunaPKI.log" layout="${longdate} ${level}: ${message}" />
		</targets>
		<rules>
			<logger name="Lacuna.Pki.*" writeTo="pkiLog" />
		</rules>
	</nlog>
</configuration>
```

> [!NOTE]
> It is very important to specify asynchronous logging (`async="true"` on the
> `targets` tag), otherwise the performance of the SDK might be considerably
> impaired.

The messages are sent with various logger names according to where the message
was originated, but all logger names are preceded by "Lacuna.Pki." (hence the
`name="Lacuna.Pki.*"` attribute on the `logger` tag).

## Dependency on NLog

In order to maximise compatibility, the package depends on an old version of the NLog package, but we strongly recommend
that you install the latest version.

## Source code

This package is open source, hosted on [BitBucket](https://bitbucket.org/Lacunas/pkinlogconnector). Feel free to fork
it if you need to make any customizations.

Within the [main class](https://bitbucket.org/Lacunas/pkinlogconnector/src/master/PkiNLogConnector/NLogLogger.cs), 
it is possible to customize operations for different log levels, as well as perform specific operations when the log is cleared.

```csharp
public void Log(LogLevels level, string message, string source) {

		var logger = loggers.GetOrAdd(source, s => LogManager.GetLogger(s));

		LogLevel logLevel;

		switch (level) {
			case LogLevels.Trace:
				logLevel = LogLevel.Trace;
				break;
			case LogLevels.Info:
				logLevel = LogLevel.Info;
				break;
			case LogLevels.Warning:
				logLevel = LogLevel.Warn;
				break;
			case LogLevels.Error:
				logLevel = LogLevel.Error;
				break;
			default:
				logLevel = LogLevel.Info;
				break;
		}
		
		logger.Log(logLevel, message);
	}		

		public void Flush() {
			NLog.LogManager.Flush();
		}
```